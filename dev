#!/bin/bash

# byNolo Development Environment Manager
# Simple script to manage development services

case "${1:-help}" in
    "start")
        echo "üöÄ Starting development services..."
        tmux new-session -d -s bynolo-backend -c "$(pwd)/api" '../.venv/bin/python run.py' 2>/dev/null || echo "Backend session exists"
        tmux new-session -d -s bynolo-frontend -c "$(pwd)" 'npm run dev:frontend' 2>/dev/null || echo "Frontend session exists"
        sleep 2
        echo "‚úÖ Services started!"
        echo "üåê Frontend: http://localhost:5173"
        echo "üîß Backend:  http://localhost:5000"
        ;;
    "stop")
        echo "üõë Stopping development services..."
        tmux kill-session -t bynolo-backend 2>/dev/null || true
        tmux kill-session -t bynolo-frontend 2>/dev/null || true
        pkill -f "python.*run.py" 2>/dev/null || true
        pkill -f "vite" 2>/dev/null || true
        echo "‚úÖ Services stopped"
        ;;
    "status")
        echo "üìä Service Status:"
        if lsof -i :5000 >/dev/null 2>&1; then
            echo "‚úÖ Backend running (port 5000)"
        else
            echo "‚ùå Backend not running"
        fi
        if lsof -i :5173 >/dev/null 2>&1; then
            echo "‚úÖ Frontend running (port 5173)"
        else
            echo "‚ùå Frontend not running"
        fi
        ;;
    "logs")
        service=${2:-"backend"}
        if [ "$service" = "frontend" ]; then
            tmux attach -t bynolo-frontend
        else
            tmux attach -t bynolo-backend
        fi
        ;;
    *)
        echo "byNolo Development Manager"
        echo ""
        echo "Usage: $0 [command]"
        echo ""
        echo "Commands:"
        echo "  start        Start both services"
        echo "  stop         Stop all services"
        echo "  status       Check service status"
        echo "  logs [type]  View logs (backend|frontend)"
        echo ""
        echo "Manual commands:"
        echo "  npm run dev        - Frontend only"
        echo "  npm run dev:backend - Backend only"
        ;;
esac
